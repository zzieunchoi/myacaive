# DB

## 모델 관계

### FOREIGN KEY

외래 키

관계형 데이터베이스에서 한 테이블(참조하는)의 필드 중 다른 테이블(참조되는)의 행을 식별할 수 있는 키

참조하는 테이블에서 속성(필드)에 해당하고, 이는 참조되는 테이블의 기본 키를 가리킴



ARTICLE(1): COMMENT(N)

![image-20220413091304964](220413-db.assets/image-20220413091304964.png)

comment의 foreign key는 하나의 article에 대응

그렇다면 comment는 참조하는 테이블/ article은 참조되는 테이블

따라서 외래키는 1:N 관계에서는 N이 가지고 있음



키를 사용하여 부모 테이블의 유일한 값을 참조(참조 무결성)

```
참조무결성
: 외래키가 선언된 테이블의 외래 키 속성(열)의 값은 그 테이블의 부모가 되는 테이블의 기본 키 값으로 존재해야함
```

외래 키의 값이 반드시 부모 테이블의 기본키일 필요는 없지만 유일한 값이어야함



FOREIGN KEY 필드(1:N 관계)

필수 인자: 참조하는 model class, on_delete

```python
class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete = models.CASCADE)
    content = models.CharField(max_length = 200)
    created_at = models.DateTimeField(auto_now_add = True)
    updated_at = models.DateTimeField(auto_now = True)
    
    def __str__(self):
        return self.content
```



on_delete 옵션

데이터 무결성을 위해서 매우 중요한 설정

외래 키가 참조하는 객체가 사라졌을 때 외래키를 가진 객체를 어떻게 처리할지를 정의

```
CASCADE: 부모 객체(참조된 객체)가 삭제되었을 때 이를 참조하는 객체도 삭제
PROTECT
SET_NULL
SET_DEFAULT
SET()
DO_NOTHING
RESTRICT
```



```
데이터 무결성:
데이터의 정확성과 일관성을 유지하고 보증하는 것을 가리킴
유형 
- 개체 무결성: 모든 테이블이 pk를 가져야하며 pk로 선택된 열은 고유한 값, 빈값 허용 x
- 참조 무결성: fk 값이 데이터 베이스의 특정 테이블의 pk 값을 참조하는 것
- 범위 무결성: 정의된 형식(범위)에서 관계형 데이터베이스의 모든 컬럼이 선언되도록 규정
```



migrations , migrate 생성 후 migration  파일 확인 -> articles_comment 테이블의 외래 키 컬럼 확인

(필드 이름에 _id가 추가됨)

장고가 외래키를 만들면 만든 클래스 이름에 _id를 붙여서 컬럼이 나옴



#### COMMENT CREATE

#### COMMENT READ

#### COMMENT DELETE



### CUSTOMIZING AUTHENTICATION IN DJANGO

#### SUBSTITUTING A CUSTOM USER MODEL

#### CUSTOM USER & BUILT IN AUTH FORMS

